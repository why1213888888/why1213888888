# 服务端API



## 使用说明

### 请求方式

服务端API 请求格式：HTTP POST 请求；请求报文格式： json报文（contentType=application/json）



### 数据安全

服务端API 针对不同接口采用安全策略：

查询敏感信息类接口采用3DES对称秘钥加密敏感信息

校验请求合法性采用SHA256签名或RSA公私钥签名

加解密和签名方法参考示例代码。

 

## 基础访问令牌

用于服务端API调用的凭证。



### 获取应用访问令牌backendToken

backendToken是应用的服务端API的访问令牌，控制对服务端API的访问。backendToken的有效期通过接口返回，目前设置为7200秒，接入方获取相应基础访问令牌后，需放入缓存，定期更新。

- 请求地址：https://open.95516.com/open/access/1.0/backendToken
- 请求参数：
| 参数      | 是否必须 | 说明                                                         |
| --------- | -------- | ------------------------------------------------------------ |
| appId     | 是       | 接入方的唯一标识                                             |
| nonceStr  | 是       | 生成签名的随机串                                             |
| timestamp | 是       | 生成签名的时间戳                                             |
| signature | 是       | 签名值，签名因子包括(appId, nonceStr, secret,  timestamp)， 签名方法：SHA-256 参见示例代码 |
- 返回参数：
| 参数         | 描述                                   |
| ------------ | -------------------------------------- |
| backendToken | 调用后台接口的基础访问令牌             |
| expiresIn    | frontToken接口调用凭证超时时间，单位秒 |
**注意：**基础访问令牌为系统全局变量，与用户行为无关。请保证在有效期内，不会多次请求获取相关基础访问令牌，频繁请求的服务器将可能会被云闪付列入黑名单。



### 获取授权访问令牌accessToken

获取用户授权访问令牌accessToken, 经过用户授权完成后，可通过授权访问令牌调用对应权限可访问的服务端API。

- 请求地址：https://open.95516.com/open/access/1.0/token

- 请求参数：
| 序号 | 参数名       | 是否必填 | 备注                         |
| ---- | ------------ | -------- | ---------------------------- |
| 1    | appId        | 是       | 接入方的唯一标识             |
| 2    | backendToken | 是       | 通过“获取应用访问令牌”获取   |
| 3    | code         | 是       | 用户授权或静默授权获取的code |
| 4    | grantType    | 是       | 常量字符串authorization_code |

- 返回参数：
| 序号 | 参数名       | 备注                                      |
| ---- | ------------ | ----------------------------------------- |
| 1    | accessToken  | 授权访问接口API调用凭证                   |
| 2    | expiresIn    | accessToken接口调用凭证超时时间，单位(秒) |
| 3    | refreshToken | 用户刷新accessToken(已废弃)               |
| 4    | openId       | 用户唯一标识                              |
| 5    | scope        | 用户授权的作用域                          |
| 6    | unionId      | 统一用户标识(所有接入方下统一用户标识)    |

 

## 基础用户信息

获取用户授权完成后，可通过服务端API获取用户基础信息，基础用户信息API返回报文所有字段均使用接入方对称秘钥symmetricKey加密，base64编码返回。



### 获取用户手机号

通过用户手机号授权(scope.mobile)完成后，通过该接口获取用户手机号。

- 请求地址：https://open.95516.com/open/access/1.0/user.mobile

- 请求参数：
| 序号 | 参数名       | 是否必填 | 备注                                   |
| ---- | ------------ | -------- | -------------------------------------- |
| 1    | appId        | 是       | 接入方的唯一标识                       |
| 2    | accessToken  | 是       | 授权访问令牌                           |
| 3    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取 |
| 4    | backendToken | 是       | 基础服务令牌，通过应用访问令牌接口获取 |

- 返回参数：
| 序号 | 参数名       | 备注       |
| ---- | ------------ | ---------- |
| 1    | mobile       | 登录手机号 |
| 2    | cntryPhoneCd | 国际区号   |

注意：
返回参数字段均加密返回，解密请参考解密方法。




### 获取用户实名信息

通过用户实名授权(scope.auth)完成后，通过该接口获取用户实名信息。


- 请求地址: https://open.95516.com/open/access/1.0/user.auth

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                   |
| ---- | ------------ | -------- | -------------------------------------- |
| 1    | appId        | 是       | 接入方的唯一标识                       |
| 2    | accessToken  | 是       | 授权访问令牌                           |
| 3    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取 |
| 4    | backendToken | 是       | 应用访问令牌                           |

- 返回参数：

| 序号 | 参数名   | 备注                                                 |
| ---- | -------- | ---------------------------------------------------- |
| 1    | realName | 用户姓名                                             |
| 2    | certTp   | 证件类型（01:身份证，03:护照，04:回乡证，05:台胞证） |
| 3    | certId   | 证件号                                               |



### 获取用户绑定的银行卡列表（仅限银行小程序使用）

通过用户银行卡授权(scope.bank) 完成后，银行小程序可获取用户绑定的该行银行卡列表信息。


- 请求地址：https://open.95516.com/open/access/1.0/oauth.getCardList

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | accessToken  | 是       | 授权访问令牌                                                 |
| 3    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取                       |
| 4    | backendToken | 是       | 基础服务令牌，通过获取应用访问令牌获取                       |
| 5    | cardTp       | 是       | 需要获取的卡列表类型：（00：全部，01：借记卡，02：贷记卡，03：准贷记卡，04：借贷合一卡） |
| 6    | needSameName | 是       | 是否要求卡同名：（0:不需要，同名卡和非同名卡都返回，1:需要，只返回同名卡） |
| 7    | needPay      | 是       | 是否要求开通支付的卡（0：不需要，支付卡和非支付卡都返回，1：需要，只返回开通支付支付卡） |
needSameName,needPay是兼容老客户端用户字段，现在客户端默认绑定都是实名卡。

- 返回参数：

| 序号 | 参数名   | 备注                         |
| ---- | -------- | ---------------------------- |
| 1    | cardList | List<Card>，返回的卡列表信息 |

- Card信息：

| 1    | cardNo         | 卡号                                                         |
| ---- | -------------- | ------------------------------------------------------------ |
| 2    | issHeadCode    | 卡机构代码                                                   |
| 3    | issHeadName    | 卡机构名称                                                   |
| 4    | cardTp         | 卡性质（01：借记卡，02：贷记卡，03：准贷记卡，04：借贷合一卡，05：预付费卡） |
| 5    | isCardPay      | 是否是支付卡（0：否，1：是）                                 |
| 6    | isSameName     | 是否是同名卡（0：否，1：是）                                 |
| 7    | reservedMobile | 卡的银行预留手机号                                           |



### 获取用户授权卡token

通过用户授权卡token(scope.token)，获取用户授权指定卡token。

- 请求地址：https://open.95516.com/open/access/1.0/user.checkedCard

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                   |
| ---- | ------------ | -------- | -------------------------------------- |
| 1    | appId        | 是       | 接入方的唯一标识                       |
| 2    | accessToken  | 是       | 授权访问调用令牌                       |
| 3    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取 |
| 4    | backendToken | 是       | 基础服务令牌，通过获取应用访问令牌获取 |

- 返回参数：

| 序号 | 参数名   | 备注                                                         |
| ---- | -------- | ------------------------------------------------------------ |
| 1    | cardNo   | 银行卡(卡bin,带掩码)                                         |
| 2    | headName | 发卡总行名称                                                 |
| 3    | headCode | 发卡总行机构代码                                             |
| 4    | cardTp   | 卡性质（01：借记卡，02：贷记卡，03：准贷记卡，04：借贷合一卡，05：预付费卡） |
| 5    | token    | 银行卡token                                                  |



### 查询用户状态

通过该接口可判断用户当前状态


- 请求地址：https://open.95516.com/open/access/1.0/user.status

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取                       |
| 3    | backendToken | 是       | 基础服务令牌，通过获取应用访问令牌获取                       |
| 4    | markTime     | 否       | 标记时间(yyyy-MM-dd HH:mm:ss),如要上送此字段,必须按照规定格式 |

- 返回参数：

| 序号 | 参数名      | 备注                                                         |
| ---- | ----------- | ------------------------------------------------------------ |
| 1    | resp        | 00: 成功； 其他： 失败                                       |
| 2    | msg         | 信息描述                                                     |
| 3    | isRegister  | 是否注册标记：1 - 已注册；0 - 未注册                         |
| 4    | isAuth      | 是否实名标记：1 - 已实名；0 - 未实名                         |
| 5    | certType    | 证件类型，如果已实名，返回证件类型编号                       |
| 5    | isBindCard  | 是否绑卡标识：1 - 绑卡；0 - 未绑卡                           |
| 6    | isOutTrans  | 是否为境外用户标识：1-境内；0-境外                           |
| 7    | newUserMark | 新用户有效标识, 若注册时间早于标记时间，则返回0； 若注册时间晚于或等于标记时间，则返回1 |



## 无感支付

用户授权无感支付签约完成后，可通过服务端API完成用户的无感支付申请签约、申请解约、签约关系查询等功能。



### 申请签约

无感支付签约接口，用户无感签约(scope:upapi_contract)授权且点击”同意授权”后，后台可通过此接口发起支付签约，签约完成后根据协议号走全渠道即可发起交易。


- 请求地址：https://open.95516.com/open/access/1.0/contract.apply

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                       |
| ---- | ------------ | -------- | ------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                           |
| 2    | accessToken  | 是       | 授权访问调用令牌                           |
| 3    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取     |
| 4    | backendToken | 是       | 授权应用访问令牌                           |
| 5    | planId       | 是       | 协议模板id，由云闪付录入模板并分配给接入方 |
| 6    | contractCode | 是       | 接入方侧的签约协议号，由接入方自行生成     |

- 返回参数：

| 序号 | 参数名       | 备注                                          |
| ---- | ------------ | --------------------------------------------- |
| 1    | contractCode | 接入方传来的签约协议号                        |
| 2    | planId       | 接入方传来的协议模板id                        |
| 3    | openId       | 用户唯一标识                                  |
| 4    | operateTime  | 操作时间                                      |
| 5    | contractId   | 签约成功后，云闪付返回的委托免密支付协议 id。 |



### 申请解约

无感支付解约，使用接入方签约时传入的”签约协议号”，通过此接口可发起无感支付解约。

- 请求地址：https://open.95516.com/open/access/1.0/contract.relieve

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                   |
| ---- | ------------ | -------- | ------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                       |
| 2    | openId       | 是       | 用户唯一标识                                           |
| 3    | backendToken | 是       | 授权应用访问令牌                                       |
| 4    | contractId   | 是       | 申请签约完成后返回委托免密支付协议id                   |
| 5    | planId       | 是       | 协议模板id，由云闪付录入模板并分配给接入方             |
| 6    | contractCode | 是       | 接入方请求签约时传入的签约协议号，由接入方生产且须唯一 |

- 返回参数：

| 序号 | 参数名       | 备注                   |
| ---- | ------------ | ---------------------- |
| 1    | contractCode | 接入方传来的签约协议号 |
| 2    | planId       | 接入方传来的协议模板id |
| 3    | openId       | 用户唯一标识           |
| 4    | operateTime  | 操作时间               |



### 签约关系查询

查询用户与接入方的签约关系状态，5分钟缓存机制，为保证查询结果准确性，建议间隔5分钟以上再进行状态查询。

- 请求地址：https://open.95516.com/open/access/1.0/contract.info

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                       |
| ---- | ------------ | -------- | ------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                           |
| 2    | openId       | 是       | 用户唯一标识                               |
| 3    | backendToken | 是       | 授权应用访问令牌                           |
| 4    | planId       | 是       | 协议模板id，由云闪付录入模板并分配给接入方 |

- 返回参数：

| 序号 | 参数名         | 备注                                  |
| ---- | -------------- | ------------------------------------- |
| 1    | contractId     | 签约协议号                            |
| 2    | contractStatus | 签约状态：空-未签约 1-已签约 3-已解约 |



### 未完成订单查询

查询已签约用户在云闪付侧是否存在业务未完成的订单。

- 请求地址：https://open.95516.com/open/access/1.0/contract.status

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注             |
| ---- | ------------ | -------- | ---------------- |
| 1    | appId        | 是       | 接入方的唯一标识 |
| 2    | openId       | 是       | 用户唯一标识     |
| 3    | backendToken | 是       | 授权应用访问令牌 |

- 返回参数：

| 序号 | 参数名 | 备注                                                      |
| ---- | ------ | --------------------------------------------------------- |
| 1    | enable | 返回0，表示无未完成订单；返回1-N，表示存在N笔未完成订单。 |



### 解约通知

根据申请无感支付解约通知接口，用户在“云闪付APP-设置-支付设置-无感支付”入口下进行无感支付解 约, 解约完成通知接入方解约结果，特殊场景(公交地铁等脱机场景)不支持云闪付侧解约。

- 请求参数：

| 序号 | 参数名      | 是否必填 | 备注                                                         |
| ---- | ----------- | -------- | ------------------------------------------------------------ |
| 1    | appId       | 是       | 接入方的唯一标识                                             |
| 2    | timestamp   | 是       | 生成签名的时间戳                                             |
| 3    | nonceStr    | 是       | 生成签名的随机串                                             |
| 4    | operateTime | 是       | 操作时间                                                     |
| 5    | openId      | 是       | 用户唯一标识                                                 |
| 6    | trid        | 是       | 特定场景使用                                                 |
| 7    | contractId  | 是       | 签约成功后，云闪付返回的签约协议号，接入方凭此发起扣款，返回数据格式为AN32 |
| 8    | signature   | 是       | 输出格式为base64，请使用银联的公钥验证签名，参见附录五       |

注意：无感支付解约通知请求方式为get请求。

- 返回参数：

| 序号 | 参数名 | 备注                                      |
| ---- | ------ | ----------------------------------------- |
| 1    | resp   | 成功接收通知以后发送 {"resp":  "00"} 返回 |



## 消息能力

为小程序提供消息推送的能力。



### 小程序模板消息

通过小程序运营平台配置小程序消息模板，通过该接口给云闪付用户推送小程序消息, 例如服务通知、动账通知。

- 请求地址：https://open.95516.com/open/access/1.0/applet.msg

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | openId       | 是       | 用户唯一标识                                                 |
| 3    | backendToken | 是       | 授权应用访问令牌                                             |
| 4    | mpId         | 是       | 小程序id                                                     |
| 5    | isPush       | 否       | 是否系统推送消息 1- 推送（默认） 0- 不推送                   |
| 6    | extra01      | 否       | 扩展字段01                                                   |
| 7    | extra02      | 否       | 扩展字段02                                                   |
| 8    | templateId   | 是       | 通知模板id                                                   |
| 9    | desc         | 是       | 通知详情(200个字符以内)                                      |
| 10   | uiType       | 是       | ui类型：1                                                    |
| 11   | adImageUrl   | 否       | 广告图url                                                    |
| 12   | adTargetUrl  | 否       | 广告落地页url                                                |
| 13   | destExt      | 否       | 小程序的附加参数                                             |
| 14   | destType     | 是       | 跳转类型 可选值:rn、html、native、applet                     |
| 15   | destInfo     | 是       | 类型：applet 就是小程序id， rn 就是 rn 的 dest html 就是 url native 就是 native 的dest |
| 16   | valueList    | 否       | 关键词列表：List<MsgValue>                                   |

- MsgValue信息：

| 字段  | 是否必须 | 说明                                                    |
| ----- | -------- | ------------------------------------------------------- |
| key   | 是       | key                                                     |
| value | 是       | value（对应key的消息文本内容，200个字符以内，换行用\n） |

其中，通知模板id、关键词列表中的key，请在“小程序开放平台-服务通知”的通知详情中获取。

 ![img](/Users/tuqiang/Workspace/Business/unionpay/applet-docs/media/02/0204-1.jpg)

- 返回参数：

| 参数           | 说明                |
| -------------- | ------------------- |
| resp           | 00,成功；其他，失败 |
| msg            | 信息描述            |
| nid            | 推送流水号          |
| notificationNo | 通知流水号          |



## 安全能力

### 获取验证支付密码流水号

获取验证支付密码流水号，用于唤起验证支付密码控件

- 请求地址：https://open.95516.com/open/access/1.0/verifyPwdSeqId

- 请求参数：

| 序号 | 参数        | 是否必须 | 说明                                        |
| ---- | ----------- | -------- | ------------------------------------------- |
| 1    | appId       | 是       | 接入方的唯一标识                            |
| 2    | openId      | 是       | 用户唯一标识                                |
| 3    | clientIp    | 否       | 终端IP                                      |
| 4    | bizOrderId  | 是       | 业务操作流水号（自定义）                    |
| 5    | bizType     | 是       | 业务类型 （小程序: 4p）                     |
| 6    | merchantId  | 是       | 商户号(小程序同appId)                       |
| 7    | nonceStr    | 是       | 生成签名的随机串                            |
| 8    | notifyUrl   | 是       | 通知地址                                    |
| 9    | timestamp   | 是       | 生成签名的时间戳                            |
| 10   | accessToken | 是       | 授权访问令牌                                |
| 11   | signature   | 是       | 请使用接入方私钥进行签名，输出格式为base64. |

- 返回参数：

| 序号 | 参数    | 说明                 |
| ---- | ------- | -------------------- |
| 1    | transNo | 订单号，业务唯一标识 |



### 支付密码验证结果通知

根据获取验证支付密码流水号接口上送的通知地址，通知接入方支付密码验证成功结果。


- 请求参数：

| 序号 | 参数       | 说明                                        |
| ---- | ---------- | ------------------------------------------- |
| 1    | appId      | 接入方的唯一标识                            |
| 2    | timestamp  | 生成签名的时间戳                            |
| 3    | nonceStr   | 生成签名的随机串                            |
| 4    | openId     | 用户唯一标识                                |
| 5    | bizOrderId | 原请求的业务操作流水号                      |
| 6    | merchantId | 商户号(小程序同appId)                       |
| 7    | bizType    | 原业务类型4p                                |
| 8    | transNo    | 原transNo                                   |
| 9    | signature  | 请使用银联的公钥验证签名，输出格式为base64. |

- 返回参数：

| 序号 | 参数名 | 备注                                 |
| ---- | ------ | ------------------------------------ |
| 1    | resp   | 成功通知以后发送 {‘resp’: ‘00’} 返回 |

说明：
云闪付侧返回订单验证结果，使用云闪付私钥进行签名，接入方需要使用云闪付发布的公钥upPublicKey对收到的通知消息进行验证签名，云闪付发布公钥参见常见问题 。



## 营销能力

提供丰富的服务端营销API, 可以组合不同营销玩法，为接入方提供营销能力。



### 赠送银联红包

接入方给云闪付用户赠送银联红包。


- 请求地址：https://open.95516.com/open/access/1.0/red.packet.give

- 请求参数：

| 序号 | 参数名      | 是否必填 | 备注                                                         |
| ---- | ----------- | -------- | ------------------------------------------------------------ |
| 1    | appId       | 是       | 接入方的唯一标识                                             |
| 2    | insAcctId   | 是       | 机构账户代码 必须18位                                        |
| 3    | transNumber | 是       | 接入方交易流水号                                             |
| 4    | openId      | 否       | 用户唯一标识                                                 |
| 5    | mobile      | 否       | 手机号使用symmetricKey 对称加密，内容为base64格式            |
| 6    | pan         | 否       | 同名卡号使用symmetricKey 对称加密，内容为base64格式          |
| 7    | pointAt     | 是       | 交易金额 单位：分，不能为负（以分为单位，使用symmetricKey 对称加密，内容为base64格式） |
| 8    | remark      | 否       | 备注信息                                                     |
| 9    | nonceStr    | 是       | 生成签名的随机串                                             |
| 10   | timestamp   | 是       | 生成签名的时间戳                                             |
| 11   | signature   | 是       | 请使用接入方私钥签名，输出格式为base64.                      |

- 返回参数：

| 序号 | 参数名 | 备注                                |
| ---- | ------ | ----------------------------------- |
| 1    | resp   | 成功通知以后发送 {'resp':'00'} 返回 |

说明：
1. 接入方使用私钥进行签名，云闪付使用接入方提供的的公钥进行验证签名。
2. openId、mobile、pan 3个参数不能同时为空，至少上送一个。
3. mobile、pan、pointAt字段加密（使用云闪付提供symmetricKey 对称加密，内容为base64格式上送，但参与签名时，请使用明文加签。
4. 除了signature之外，请求参数中所有字段参与验签。所有待签名参数（字符编码为 UTF-8）按照字段名的ASCII 码从小到大排序（字典序）后，使用键值对的格式（key1=value1&key2=value2…）拼接成字符串string1。对拼接字符串string1进行RSA签名后，按base64格式出现在报文中。



### 赠送专享红包

接入方给云闪付用户赠送专享红包。


- 请求地址：https://open.95516.com/open/access/1.0/point.acquire

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | transSeqId   | 是       | 交易流水号,不重复，最大64位                                  |
| 3    | transTs      | 是       | 交易时间,格式: yyyymmddhhmmss                                |
| 4    | nonceStr     | 是       | 随机字符串，用于验签                                         |
| 5    | insAcctId    | 是       | 机构账户代码，最大32位                                       |
| 6    | mobile       | 否       | 交易手机号，若上送，（使用symmetricKey 对称加密，内容为base64格式） |
| 7    | cardNo       | 否       | 交易卡号，若上送，（使用symmetricKey 对称加密，内容为base64格式） |
| 8    | openId       | 否       | 用户唯一标识                                                 |
| 9    | acctEntityTp | 是       | 账户主体类型，2位，可选：01-手机号 02-卡号 03-用户（三选一） |
| 10   | pointId      | 是       | 积分id，最大64位                                             |
| 11   | pointAt      | 是       | 积分额，最大12位,单位以分计算                                |
| 12   | validBeginTs | 否       | 有效起始时间，格式：yyyymmddhhmmss                           |
| 13   | validEndTs   | 否       | 有效截止时间，格式：yyyymmddhhmmss                           |
| 14   | busiInfo     | 是       | 业务信息，最大1024位,包含自定义活动ID,活动名称两个小字段，格式为 {"campaignId":"活动ID","campaignName":"活动名称"},ps：活动ID确保唯一 |
| 15   | transDigest  | 是       | 交易摘要，最大200位,赠送积分说明，用于前台展示               |
| 17   | remark       | 否       | 备注，最大512位                                              |
| 18   | timestamp    | 是       | 时间戳，用于验签                                             |
| 19   | signature    | 是       | 签名值                                                       |

- 返回参数：

| 序号 | 参数       | 说明                           |
| ---- | ---------- | ------------------------------ |
| 1    | resp       | 交易结果，00：成功；其他：失败 |
| 2    | msg        | 消息描述                       |
| 3    | transSeqId | 原交易流水号                   |
| 4    | retResTime | 结果时间，格式：yyyyMMddHHmmss |



### 银联红包余额查询

查询银联红包接入方账户余额查询。

- 请求地址：https://open.95516.com/open/access/1.0/red.packet.select

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                       |
| ---- | ------------ | -------- | ------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                           |
| 2    | insAcctId    | 是       | 机构账户代码 必须18位                      |
| 3    | transNumber  | 是       | 接入方交易流水号                           |
| 4    | transDt      | 是       | 请求日期 YYYYMMDD例：20190712              |
| 5    | transTm      | 是       | 请求时间 YYYYMMDDHHMMSS 例：20190712144820 |
| 6    | backendToken | 是       | 授权应用访问令牌                           |

- 返回参数：

| 序号 | 参数名         | 备注                                                    |
| ---- | -------------- | ------------------------------------------------------- |
| 1    | acctSt         | 账户状态（使用symmetricKey 对称加密，内容为base64格式） |
| 2    | acctBalance    | 账户余额（使用symmetricKey 对称加密，内容为base64格式） |
| 3    | validBeginDtTm | 有效开始时间                                            |
| 4    | validEndDtTm   | 有效结束时间                                            |



### 专享红包余额查询

根据专享红包活动id查询用户的该专享红包余额。

- 请求地址：https://open.95516.com/open/access/1.0/point.balance

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | pointId      | 是       | 专享活动活动id                                               |
| 3    | acctEntityTp | 是       | 账户主体类型：01-手机号；02-卡号；03-用户，即openId          |
| 4    | acctEntityId | 是       | 账户主体值，类型填写01，则对应填写具体手机号，类型填写02，则对应填写具体卡号，类型填写03，则对应填写具体openId（3种类型值均需要使用  symmetricKey 对称密钥加密，内容为 base64 格式） |
| 5    | backendToken | 是       | 后台接口调用凭证                                             |
| 6    | transTs      | 是       | 交易时间yyyyMMddhhmmss                                       |
| 7    | accessId     | 是       | 专享红包来源：UP-银联；SC-其他                               |
| 8    | transSeq     | 是       | 流水号                                                       |
| 9    | remark       | 是       | 备注                                                         |

- 返回参数：

| 序号 | 参数名 | 备注                                  |
| ---- | ------ | ------------------------------------- |
| 1    | resp   | 交易结果，00：成功；其他：失败        |
| 2    | msg    | 消息描述                              |
| 3    | params | 红包明细；类型为：IntegralBalanceResp |

- IntegralBalanceResp类 ：

| 序号 | 参数名          | 备注         |
| ---- | --------------- | ------------ |
| 1    | acctSt          | 账户状态     |
| 2    | avlBalance      | 可用金额     |
| 3    | frozenBalance   | 冻结金额     |
| 4    | operBalance     | 消费金额     |
| 5    | expireBalance   | 过期金额     |
| 6    | todeductBalance | 待抵扣金额   |
| 7    | acctOpenTp      | 开户方式     |
| 8    | acctOpenDt      | 开户日期     |
| 9    | reservedField   | 保留字段     |
| 10   | recUpdTs        | 记录更新时间 |



### 抽奖资格赠送

接入方给云闪付用户赠送抽奖资格。

- 请求地址：https://open.95516.com/open/access/1.0/qual.send

- 请求参数：

| 序号 | 参数名      | 是否必填 | 备注                                                        |
| ---- | ----------- | -------- | ----------------------------------------------------------- |
| 1    | appId       | 是       | 接入方的唯一标识                                            |
| 2    | qualNum     | 是       | 资格池编号                                                  |
| 3    | qualType    | 是       | 资格类型固定值“open_id”、“mobile”、“card_no”                |
| 4    | qualValue   | 是       | 资格值（使用symmetricKey 对称加密，内容为base64格式）       |
| 5    | count       | 是       | 资格增加次数（使用symmetricKey 对称加密，内容为base64格式） |
| 6    | transNumber | 是       | 流水号（确保唯一）                                          |
| 7    | startDate   | 是       | 资格起始时间 格式为yyyyMMdd                                 |
| 8    | endDate     | 是       | 资格结束时间 格式为yyyyMMdd                                 |
| 9    | nonceStr    | 是       | 生成签名的随机串                                            |
| 10   | timestamp   | 是       | 生成签名的时间戳                                            |
| 11   | signature   | 是       | 请使用接入方私钥签名，输出格式为base64.                     |

- 返回参数：

| 序号 | 参数名 | 备注                                 |
| ---- | ------ | ------------------------------------ |
| 1    | resp   | 成功通知以后发送 {‘resp’: ‘00’} 返回 |



### 抽奖资格查询

接入方查询云闪付用户的抽奖资格。

- 请求地址：https://open.95516.com/open/access/1.0/qual.select

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                  |
| ---- | ------------ | -------- | ----------------------------------------------------- |
| 1    | appId        | 是       | 接入方的唯一标识                                      |
| 2    | qualNum      | 是       | 资格池编号                                            |
| 3    | qualType     | 是       | 资格类型固定值“open_id”、“mobile”、“card_no”          |
| 4    | qualValue    | 是       | 资格值（使用symmetricKey 对称加密，内容为base64格式） |
| 5    | backendToken | 是       | 后台接口授权token                                     |

- 返回参数：

| 序号 | 参数名  | 备注                                                         |
| ---- | ------- | ------------------------------------------------------------ |
| 1    | qualMap | 满足要求的资格为map结构，key是资格有效期拼接格式如 20171108_20171101（结束日期在前），value为资格次数 |



### 抽奖

接入方通过资格赠送云闪付抽奖（红包/票券）接口资格，给用户赠送（非定额/定额）红包或者商城券。

- 请求地址：https://open.95516.com/open/access/1.0/qual.reduce

- 请求参数：

| 序号 | 参数名         | 是否必填 | 备注                                                    |
| ---- | -------------- | -------- | ------------------------------------------------------- |
| 1    | appId          | 是       | 接入方的唯一标识                                        |
| 2    | activityNumber | 是       | 活动编号                                                |
| 3    | orderAmount    | 否       | 订单金额                                                |
| 4    | qualNum        | 是       | 资格池编号                                              |
| 5    | qualType       | 是       | 资格类型固定值“open_id”、“mobile”、“card_no”            |
| 6    | qualValue      | 是       | 资格值（使用symmetricKey 对称加密，内容为base64格式）   |
| 7    | certId         | 否       | 身份证号（使用symmetricKey 对称加密，内容为base64格式） |
| 8    | icTerminal     | 否       | 设备终端                                                |
| 9    | qrCode         | 否       | 红包码                                                  |
| 10   | transNumber    | 是       | 流水号（确保唯一）                                      |
| 11   | nonceStr       | 是       | 生成签名的随机串                                        |
| 12   | timestamp      | 是       | 生成签名的时间戳                                        |
| 13   | signature      | 是       | 请使用接入方私钥签名，输出格式为base64.                 |

- 返回参数：

| 序号 | 参数名      | 备注                                 |
| ---- | ----------- | ------------------------------------ |
| 1    | resp        | 成功通知以后发送 {‘resp’: ‘00’} 返回 |
| 2    | respTime    | 结果时间 yyyyMMddHHmmss              |
| 3    | awardInfo   | 奖项信息                             |
| 4    | transNumber | 订单流水号                           |

- awardInfo奖项信息：

| 数据名称        | 中文名称                 | 说明                                 |
| --------------- | ------------------------ | ------------------------------------ |
| activityNumber  | 活动编号                 |                                      |
| activityName    | 活动名称                 |                                      |
| beginTime       | 活动开始时间             |                                      |
| endTime         | 活动结束时间             |                                      |
| awardId         | 奖项Id                   |                                      |
| awardType       | 奖项类型                 | 06：红包07：商城券                   |
| awardName       | 奖项名称                 |                                      |
| awardValue      | 奖项值                   | 红包为红包金额，单位:分 商城券为张数 |
| extAcctId       | 外部账户id               | 商城券为券ID                         |
| extAcctName     | 外部账户名称             | 商城券为券名称                       |
| drawDesc        | 中奖说明                 |                                      |
| couponStartDate | 商城券生效开始时间       |                                      |
| couponEndDate   | 商城券生效结束时间       |                                      |
| couponGoodsUrl  | 商城券对应商品的链接地址 |                                      |



### 直接抽奖

用于营销活动直接抽奖。

- 请求地址：https://open.95516.com/open/access/1.0/maktg.draw

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | transSeqId   | 是       | 交易流水号,不重复，最大64位                                  |
| 3    | transTs      | 是       | 请求日期,格式: yyyyMMdd                                      |
| 4    | orderAt      | 否       | 订单金额                                                     |
| 5    | nonceStr     | 是       | 随机字符串，用于验签                                         |
| 6    | mobile       | 否       | 交易手机号，若上送，（使用symmetricKey  对称加密，内容为base64格式） |
| 7    | cardNo       | 否       | 交易卡号，若上送，（使用symmetricKey  对称加密，内容为base64格式） |
| 8    | openId       | 否       | 用户唯一标识                                                 |
| 9    | icTmn        | 否       | 设备终端                                                     |
| 10   | certId       | 否       | 证件号，若上送，（使用symmetricKey  对称加密，内容为base64格式） |
| 11   | activityNo   | 是       | 活动编号                                                     |
| 12   | qrCode       | 否       | 红包码                                                       |
| 13   | acctEntityTp | 是       | 赠送维度，2位，可选：01-手机号 02-卡号 03-用户（三选一）     |
| 14   | signature    | 是       | 签名值                                                       |
| 15   | timestamp    | 是       | 时间戳，用于验签                                             |

- 返回参数：

| 序号 | 参数       | 说明                |
| ---- | ---------- | ------------------- |
| 1    | resp       | 00,成功；其他，失败 |
| 2    | msg        | 消息描述            |
| 3    | transSeqId | 交易流水号          |
| 4    | retResTime | 结果时间            |
| 5    | info       | 奖项明细(AwardInfo) |

- 奖项AwardInfo类：

| 序号 | 参数               | 说明                             |
| ---- | ------------------ | -------------------------------- |
| 1    | activityNumber     | 活动编号                         |
| 2    | activityName       | 活动名称                         |
| 3    | beginTime          | 活动开始时间                     |
| 4    | endTime            | 活动结束时间                     |
| 5    | awardId            | 奖项ID                           |
| 6    | awardType          | 奖项类型                         |
| 7    | awardName          | 奖项名称                         |
| 8    | awardValue         | 奖项值                           |
| 9    | awardLevel         | 奖项等级                         |
| 10   | extAcctId          | 外部账户id                       |
| 11   | extAcctName        | 外部账户名称                     |
| 12   | drawDesc           | 中奖说明                         |
| 13   | couponStartDate    | 生效开始时间                     |
| 14   | couponEndDate      | 生效结束时间                     |
| 15   | couponGoodsUrl     | 跳转链接地址                     |
| 16   | enterCloseDateType | 票券截止日类型，0：指定日1：顺延 |
| 17   | enterCloseDate     | 票券有效期                       |

签名方法说明：
除了signature之外，请求参数中**所有不为空字段参与验签**。所有待签名参数（字符编码为 UTF-8）按照字段名的ASCII 码从小到大排序（字典序）后，使用键值对的格式（即key1=value1&key2=value2…）拼接成字符串string1。对拼接字符串string1进行RSA签名后，按base64格式出现在报文中。



### 赠送优惠券

赠送优惠券接口，根据营销活动给云闪付用户赠送优惠券

- 请求地址：https://open.95516.com/open/access/1.0/coupon.download

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | transSeqId   | 是       | 交易流水号,不重复，最大64位                                  |
| 3    | transTs      | 是       | 请求日期, 格式yyyyMMdd，如：20191227                         |
| 4    | couponId     | 是       | 优惠券id                                                     |
| 5    | mobile       | 否       | 交易手机号， 若上送（使用symmetricKey 对称加密，内容为base64格式） |
| 6    | cardNo       | 否       | 交易卡号，若上送 （使用symmetricKey 对称加密，内容为base64格式） |
| 7    | openId       | 否       | 用户唯一标识                                                 |
| 8    | acctEntityTp | 是       | 营销活动配置的赠送维度（参见营销平台活动配置） 2位（二选一），可选： 02-卡号 赠送维度为卡号时，则cardNo必填； 03-用户 赠送维度为用户时，则openId，mobile, cardNo三选一上送； |
| 9    | couponNum    | 是       | 优惠券数量                                                   |
| 10   | nonceStr     | 是       | 随机字符串，用于验签                                         |
| 11   | signature    | 是       | 签名值                                                       |
| 12   | timestamp    | 是       | 时间戳，用于验签                                             |

- 返回参数：

| 序号 | 参数       | 说明                |
| ---- | ---------- | ------------------- |
| 1    | resp       | 00,成功；其他，失败 |
| 2    | msg        | 信息描述            |
| 3    | transSeqId | 交易流水号          |
| 4    | couponId   | 优惠券id            |



### 赠送优惠券结果查询

赠送优惠券结果查询

- 请求地址：https://open.95516.com/open/access/1.0/coupon.query

- 请求参数：

| 序号 | 参数名         | 是否必填 | 备注                                                     |
| ---- | -------------- | -------- | -------------------------------------------------------- |
| 1    | appId          | 是       | 接入方的唯一标识                                         |
| 2    | origTransSeqId | 是       | 原交易流水号（赠送优惠券时流水号）                       |
| 3    | origTransTs    | 是       | 原请求日期（赠送优惠券日期），格式yyyyMMdd，如：20191227 |
| 4    | transSeqId     | 是       | 交易流水号                                               |
| 5    | transTs        | 是       | 请求日期，格式yyyyMMdd，如：20191227                     |
| 6    | backendToken   | 是       | 后台接口授权token                                        |

- 返回参数：

| 序号 | 参数           | 说明                |
| ---- | -------------- | ------------------- |
| 1    | resp           | 00,成功；其他，失败 |
| 2    | msg            | 信息描述            |
| 3    | origTransSeqId | 原交易流水号        |



### 优惠券状态变动通知

根据接入方在营销配置的优惠券活动，由开放平台通知接入方优惠券状态变动。

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | transSeqId   | 否       | 交易流水号                                                   |
| 3    | transTs      | 是       | 交易时间, 格式yyyyMMdd，如：20191227                         |
| 4    | traceId      | 是       | 跟踪号(原交易流水号)                                         |
| 5    | discountId   | 是       | 优惠券id                                                     |
| 6    | discountName | 是       | 优惠券名称                                                   |
| 7    | nonceStr     | 是       | 随机字符串，用于验签                                         |
| 8    | discountNum  | 是       | 优惠券数量                                                   |
| 9    | entityTp     | 是       | 主体类型(2位，：用户、卡号、手机号【三选一】） 01-手机号   02-卡号   03-用户 |
| 10   | entityId     | 是       | 用户标识 entityTp为03:代表openId, entityTp为02:代表卡号, entityTp为01:代表手机号 其中,卡号,手机号,为加密返回,不可逆转 |
| 11   | timestamp    | 是       | 时间戳，用于验签                                             |
| 12   | operaTp      | 是       | 操作类型 01：优惠券承兑 02：优惠券返还 03：优惠券无操作 04：优惠券获取 05：优惠券删除 06：优惠券过期 |
| 13   | transTp      | 否       | 交易类型01消费，31撤销，04退货                               |
| 14   | mchntCd      | 否       | 商户编号                                                     |
| 15   | posTmn       | 否       | Pos终端号                                                    |
| 16   | orderNo      | 否       | 订单号                                                       |
| 17   | orderAt      | 否       | 订单金额                                                     |
| 18   | discountAt   | 否       | 优惠金额                                                     |
| 19   | signature    | 是       | 签名值                                                       |
| 20   | transChnl    | 否       | 交易渠道号                                                   |

- 返回参数：

| 序号 | 参数 | 说明                                                        |
| ---- | ---- | ----------------------------------------------------------- |
| 1    | resp | 00,成功；其他，失败成功接收通知以后发送 {‘resp’: ‘00’} 返回 |



### 优惠券活动剩余名额查询

返回营销系统配置的优惠券活动剩余名额。

- 请求地址：https://open.95516.com/open/access/1.0/activity.quota

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                                         |
| ---- | ------------ | -------- | ------------------------------------------------------------ |
| 1    | appId        | 是       | 接入方的唯一标识                                             |
| 2    | transSeqId   | 是       | 唯一流水号                                                   |
| 3    | activityNo   | 是       | 活动编号                                                     |
| 4    | activityType | 是       | 活动类型: 1.u点全场立减（同原线上立减）、 2.u点全场券、 3.线下立减、 4.折扣券、 5.代金券、 6.满抵券、 7.随机立减券、 8.凭证券、 9.提货券、 10.送货券、 11.精准营销展示券、 12.单品券、 13.单品立减 |
| 5    | backendToken | 是       | 授权应用访问令牌                                             |

- 返回参数：

| 序号 | 参数                 | 说明                                                         |
| ---- | -------------------- | ------------------------------------------------------------ |
| 1    | resp                 | 00,成功；其他，失败                                          |
| 2    | msg                  | 信息描述                                                     |
| 3    | transSeqId           | 请求流水号                                                   |
| 4    | activityNo           | 活动编号                                                     |
| 5    | activityName         | 活动名称                                                     |
| 6    | activityType         | 活动类型: 1.u点全场立减（同原线上立减）、 2.u点全场券、 3.线下立减、 4.折扣券、 5.代金券、 6.满抵券、 7.随机立减券、 8.凭证券、 9.提货券、 10.送货券、 11.精准营销展示券、 12.单品券、 13.单品立减 |
| 7    | beginTime            | 活动开始时间                                                 |
| 8    | endTime              | 活动结束时间                                                 |
| 9    | activityStatus       | 活动状态，00:停用,01:启用                                    |
| 10   | limitType            | 限制类型：01:金额限制，02:次数限制，03:金额次数同时限制      |
| 11   | activityMark         | 活动标识：01:活动或票券全部分配，02:活动或票券按日平均分配，03:活动或票券按指定日或周几分配，04:活动或票券按月平均分配，05:活动或票券按年分配 |
| 12   | startMark            | 启动标识，1:今天是活动日，2:今天不是活动日                   |
| 13   | allAmount            | 总金额，单位分                                               |
| 14   | allRemainAmount      | 总剩余金额，单位分                                           |
| 15   | allAmountUseupTime   | 总金额用完时间                                               |
| 16   | monthAmount          | 当月总金额                                                   |
| 17   | monthRemainAmount    | 当月总剩余金额                                               |
| 18   | monthAmountUseupTime | 当月总金额用完时间                                           |
| 19   | dayAmount            | 当天总金额                                                   |
| 20   | dayRemainAmount      | 当天总剩余金额                                               |
| 21   | dayAmountUseupTime   | 当天总金额用完时间                                           |
| 22   | allCount             | 总次数                                                       |
| 23   | allRemainCount       | 总剩余次数                                                   |
| 24   | allCountUseupTime    | 总次数用完时间                                               |
| 25   | monthCount           | 当月总次数                                                   |
| 26   | monthRemainCount     | 当月总剩余次数                                               |
| 27   | monthCountUseupTime  | 当月总次数用完时间                                           |
| 28   | dayCount             | 当天总次数                                                   |
| 29   | dayRemainCount       | 当天总剩余次数                                               |
| 30   | dayCountUseupTime    | 当天总次数用完时间                                           |
| 31   | yearAmount           | 当年总金额                                                   |
| 32   | yearRemainAmount     | 当年总剩余金额                                               |
| 33   | yearAmountUseupTime  | 当年总金额用完时间                                           |
| 34   | yearCount            | 当年总次数                                                   |
| 35   | yearRemainCount      | 当年总剩余次数                                               |
| 36   | yearCountUseupTime   | 当年总次数用完时间                                           |
| 37   | awardShowInfoList    | 奖项剩余额度列表，List<AwardShowInfo>                        |

- AwardShowInfo信息：

| 序号 | 参数                 | 说明                                                         |
| ---- | -------------------- | ------------------------------------------------------------ |
| 1    | activityNo           | 活动编号                                                     |
| 2    | activityName         | 活动名称                                                     |
| 3    | activityType         | 活动类型: 1.u点全场立减（同原线上立减）、2.u点全场券、3线下立减、4折扣券、5代金券、6满抵券、7随机立减券、8凭证券、9提货券、10送货券、11精准营销展示券、12单品券、13单品立减 |
| 4    | beginTime            | 活动开始时间                                                 |
| 5    | endTime              | 活动结束时间                                                 |
| 6    | activityStatus       | 活动状态，00:停用,01:启用                                    |
| 7    | limitType            | 限制类型：01:金额限制，02:次数限制，03:金额次数同时限制      |
| 8    | activityMark         | 活动标识：01:活动或票券全部分配，02:活动或票券按日平均分配，03:活动或票券按指定日或周几分配，04:活动或票券按月平均分配，05:活动或票券按年分配 |
| 9    | startMark            | 启动标识，1:今天是活动日，2:今天不是活动日                   |
| 10   | allAmount            | 总金额，单位分                                               |
| 11   | allRemainAmount      | 总剩余金额，单位分                                           |
| 12   | allAmountUseupTime   | 总金额用完时间                                               |
| 13   | monthAmount          | 当月总金额                                                   |
| 14   | monthRemainAmount    | 当月总剩余金额                                               |
| 15   | monthAmountUseupTime | 当月总金额用完时间                                           |
| 16   | dayAmount            | 当天总金额                                                   |
| 17   | dayRemainAmount      | 当天总剩余金额                                               |
| 18   | dayAmountUseupTime   | 当天总金额用完时间                                           |
| 19   | allCount             | 总次数                                                       |
| 20   | allRemainCount       | 总剩余次数                                                   |
| 21   | allCountUseupTime    | 总次数用完时间                                               |
| 22   | monthCount           | 当月总次数                                                   |
| 23   | monthRemainCount     | 当月总剩余次数                                               |
| 24   | monthCountUseupTime  | 当月总次数用完时间                                           |
| 25   | dayCount             | 当天总次数                                                   |
| 26   | dayRemainCount       | 当天总剩余次数                                               |
| 27   | dayCountUseupTime    | 当天总次数用完时间                                           |
| 28   | yearAmount           | 当年总金额                                                   |
| 29   | yearRemainAmount     | 当年总剩余金额                                               |
| 30   | yearAmountUseupTime  | 当年总金额用完时间                                           |
| 31   | yearCount            | 当年总次数                                                   |
| 32   | yearRemainCount      | 当年总剩余次数                                               |
| 33   | yearCountUseupTime   | 当年总次数用完时间                                           |



## 人脸识别

用户通过授权完成人脸识别功能后，接入方可获取活体检测中采集的照片和视频。



### 获取人脸识别照片

- 请求地址：https://open.95516.com/open/access/1.0/face.image

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                   |
| ---- | ------------ | -------- | -------------------------------------- |
| 1    | appId        | 是       | 接入方的唯一标识                       |
| 2    | accessToken  | 是       | 授权访问令牌                           |
| 3    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取 |
| 4    | backendToken | 是       | 基础服务令牌，通过应用访问令牌接口获取 |

- 返回参数：

| 序号 | 参数名 | 备注                 |
| ---- | ------ | -------------------- |
| 1    | image  | 人脸照片；base64编码 |



### 获取人脸识别视频

- 请求地址：https://open.95516.com/open/access/1.0/face.video

- 请求参数：

| 序号 | 参数名       | 是否必填 | 备注                                   |
| ---- | ------------ | -------- | -------------------------------------- |
| 1    | appId        | 是       | 接入方的唯一标识                       |
| 2    | accessToken  | 是       | 授权访问令牌                           |
| 3    | openId       | 是       | 用户唯一标识，通过获取授权访问令牌获取 |
| 4    | backendToken | 是       | 基础服务令牌，通过应用访问令牌接口获取 |

- 返回参数：

| 序号 | 参数名 | 备注                     |
| ---- | ------ | ------------------------ |
| 1    | vedio  | 活体检测视频；base64编码 |



## 用户状态通知

### 修改个人信息通知

调用接入方通知地址，通知接入方用户修改个人信息。开放平台只通知接入方用户修改了个人信息，如果接入方需要获取新的用户信息，可以发起清除缓存的该用户信息，通过用户再次授权获取新的用户信息。


- 请求参数：

| 序号 | 参数名     | 是否必填 | 备注                                                |
| ---- | ---------- | -------- | --------------------------------------------------- |
| 1    | appId      | 是       | 接入方的唯一标识                                    |
| 2    | openId     | 是       | 用户唯一标识                                        |
| 3    | modifyType | 是       | 修改信息类型1：用户修改手机号                       |
| 4    | timestamp  | 是       | 通知消息发送时间戳                                  |
| 5    | nonceStr   | 是       | 随机字符串                                          |
| 6    | signature  | 是       | RSA签名值，格式为base64，请使用云闪付的公钥验证签名 |

说明：signature的计算签名串为appId=appId&modifyType=modifyType&nonceStr=nonceStr&openId=openId×tamp=timestamp云闪付发布公钥参见常见问题

- 返回参数：

| 序号 | 参数名 | 备注                                 |
| ---- | ------ | ------------------------------------ |
| 1    | resp   | 成功通知以后发送 {‘resp’: ‘00’} 返回 |



### 用户注销通知

调用接入方通知地址，通知接入方用户已注销。

- 请求参数：

| 序号 | 参数名    | 是否必填 | 备注                                                |
| ---- | --------- | -------- | --------------------------------------------------- |
| 1    | appId     | 是       | 接入方的唯一标识                                    |
| 2    | openId    | 是       | OAUTH2中获取的openId                                |
| 3    | scope     | 是       | 固定值：all                                         |
| 4    | timestamp | 是       | 通知消息发送时间戳                                  |
| 5    | nonceStr  | 是       | 随机字符串                                          |
| 6    | signature | 是       | RSA签名值，格式为base64，请使用云闪付的公钥验证签名 |

说明：signature的计算种子为appId=appId&nonceStr=nonceStr&openId=openId&scope=all&timestamp=timestamp
云闪付发布公钥参见常见问题

- 返回参数：

| 序号 | 参数名 | 备注                                 |
| ---- | ------ | ------------------------------------ |
| 1    | resp   | 成功通知以后发送 {‘resp’: ‘00’} 返回 |



### 用户关注/绑卡事件通知

调用接入方通知地址，通知接入方用户关注/取消关注/绑卡/解绑卡的信息，用户绑卡/解绑卡事件通知仅限金融小程序使用。

- 请求参数：

| 序号 | 参数名     | 是否必填 | 备注                                                         |
| ---- | ---------- | -------- | ------------------------------------------------------------ |
| 1    | appId      | 是       | 接入方的唯一标识                                             |
| 2    | sendTo     | 是       | 小程序id                                                     |
| 3    | openId     | 是       | 用户唯一标识                                                 |
| 4    | createTime | 是       | 事件发生时间（yyyy-MM-dd HH:mm:ss）                          |
| 5    | msgType    | 是       | 事件类型大类（粉丝通知：event）                              |
| 6    | event      | 是       | 事件类型小类（关注：follow，取关：unfollow，绑卡：bindCard，解绑：unbindCard） |
| 7    | timestamp  | 是       | 生成签名的时间戳                                             |
| 8    | nonceStr   | 是       | 随机字符串                                                   |
| 9    | name       | 是       | 姓名（事件小类为绑卡时返回，使用symmetricKey 对称加密，内容为base64格式） |
| 10   | certTp     | 是       | 证件类型（事件小类为绑卡时返回）                             |
| 11   | certId     | 是       | 证件号（事件小类为绑卡时返回，使用symmetricKey 对称加密，内容为base64格式） |
| 12   | cardNo     | 是       | 卡号（事件小类为绑卡时返回，使用symmetricKey 对称加密，内容为base64格式） |
| 13   | signature  | 是       | RSA签名值，格式为base64，请使用云闪付的公钥验证签名          |

说明：signature的计算种子为所有因子字典排序后的待签名串。云闪付发布公钥参见常见问题

- 返回参数：

| 序号 | 参数名 | 备注                                 |
| ---- | ------ | ------------------------------------ |
| 1    | resp   | 成功通知以后发送 {‘resp’: ‘00’} 返回 |

 